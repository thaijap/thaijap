<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ThaiJap Admin | Stocks & Commandes</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --red: #BC002D; --black: #121212; --gold: #C5A059; --green: #2ecc71; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: #000; color: #fff; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 320px; background: #1a1a1a; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .main { flex: 1; overflow-y: auto; background: #050505; padding: 10px; }
        .history { width: 300px; background: #111; overflow-y: auto; border-left: 1px solid #333; }
        .panel-header { padding: 15px; background: #000; color: var(--red); font-weight: 700; border-bottom: 2px solid var(--red); text-align: center; text-transform: uppercase; }
        .stock-item { background: #151515; padding: 10px; border-bottom: 1px solid #333; }
        .variant-row { display: flex; justify-content: space-between; font-size: 0.75rem; margin-top: 5px; padding-left: 10px; color: #ccc; }
        .btn-toggle { border: none; padding: 4px 8px; cursor: pointer; border-radius: 3px; font-weight: 700; font-size: 0.65rem; color: #fff; }
        .on { background: var(--green); } .off { background: var(--red); }
        .order-card { background: #1a1a1a; padding: 15px; border-radius: 4px; border-top: 4px solid var(--red); margin-bottom: 15px; }
        .btn-pay { width: 48%; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: 700; margin-top: 10px; color: #fff; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="panel-header">ðŸ“¦ STOCKS</div>
        <div id="stock-list" style="overflow-y:auto;"></div>
    </aside>
    <main class="main">
        <div class="panel-header">ðŸ”¥ EN COURS</div>
        <div id="order-list"></div>
    </main>
    <aside class="history">
        <div class="panel-header">ðŸ“Š HISTORIQUE</div>
        <div id="history-list"></div>
    </aside>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCiqOVjzAS5Crn4SPBkY3btyJtuCBgddpY", databaseURL: "https://thaijap-default-rtdb.europe-west1.firebasedatabase.app", projectId: "thaijap", appId: "1:84821188454:web:0078ba82b4affbe0abb2a7" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // STOCK & VARIANTES
        db.ref('/').on('value', snap => {
            const data = snap.val(); let h = "";
            ["entrees", "sushis", "plats", "boissons", "desserts"].forEach(cat => {
                h += `<div style="background:var(--red); padding:5px 10px; font-size:0.7rem; font-weight:700;">${cat.toUpperCase()}</div>`;
                for(let id in data) {
                    if(id.startsWith('p') && data[id].categorie === cat) {
                        const p = data[id]; const globalOff = p.dispo === false;
                        h += `<div class="stock-item">
                            <div style="display:flex;justify-content:space-between;align-items:center;">
                                <span style="font-size:0.85rem; color:var(--gold); font-weight:700;">${p.nom}</span>
                                <button class="btn-toggle ${globalOff?'off':'on'}" onclick="db.ref('${id}/dispo').set(${globalOff})">${globalOff?'OFF':'ON'}</button>
                            </div>`;
                        if(p.specials) {
                            p.specials.forEach((s, i) => {
                                const sOff = s.dispo === false;
                                h += `<div class="variant-row"><span>${s.v}</span><button class="btn-toggle ${sOff?'off':'on'}" onclick="db.ref('${id}/specials/${i}/dispo').set(${sOff})">${sOff?'OFF':'ON'}</button></div>`;
                            });
                        } else if(p.options) {
                            p.options.forEach((o, i) => {
                                const oOff = p.optionsDispo && p.optionsDispo[i] === false;
                                h += `<div class="variant-row"><span>${o}</span><button class="btn-toggle ${oOff?'off':'on'}" onclick="db.ref('${id}/optionsDispo/${i}').set(${!oOff})">${oOff?'OFF':'ON'}</button></div>`;
                            });
                        }
                        h += `</div>`;
                    }
                }
            });
            document.getElementById('stock-list').innerHTML = h;
        });

        // COMMANDES & HISTORIQUE
        db.ref('commandes').on('value', snap => {
            const data = snap.val(); let oH = "", hH = ""; let jours = {};
            for(let id in data) {
                const o = data[id]; const date = o.date || new Date().toLocaleDateString('fr-FR');
                if(o.statut === "PayÃ©") {
                    if(!jours[date]) jours[date] = 0; jours[date] += parseFloat(o.total);
                    hH = `<div style="padding:10px; border-bottom:1px solid #222; font-size:0.75rem;">T-${o.table} : ${o.total}â‚¬ (${o.modePaiement})</div>` + hH;
                } else {
                    oH += `<div class="order-card">
                        <div style="font-weight:700; color:var(--red);">TABLE ${o.table} <span style="float:right; color:#666;">${o.heure}</span></div>
                        <div style="margin:10px 0; font-size:0.85rem;">${o.articles.map(a => `â€¢ ${a.nom}${a.note?' <i style="color:var(--green)">('+a.note+')</i>':''}`).join('<br>')}</div>
                        <div style="text-align:right; font-weight:700; border-top:1px solid #333; padding-top:5px;">TOTAL: ${o.total}â‚¬</div>
                        <div style="display:flex; justify-content:space-between;">
                            <button class="btn-pay" style="background:var(--green);" onclick="payer('${id}','ESP')">ESPÃˆCES</button>
                            <button class="btn-pay" style="background:#3498db;" onclick="payer('${id}','CB')">CARTE</button>
                        </div>
                    </div>`;
                }
            }
            document.getElementById('order-list').innerHTML = oH;
            let jH = ""; for(let j in jours) { jH += `<div style="background:#222; padding:10px; font-weight:700; color:var(--gold);">${j} : ${jours[j].toFixed(2)}â‚¬</div>`; }
            document.getElementById('history-list').innerHTML = jH + hH;
        });

        function payer(id, mode) {
            db.ref('commandes/'+id).update({ statut: "PayÃ©", modePaiement: mode, date: new Date().toLocaleDateString('fr-FR') });
        }
    </script>
</body>
</html>
